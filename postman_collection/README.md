## Postman-коллекция для проверки API

Файл `Ymdb-collection.postman_collection.json` содержит postman-коллекцию - набор заранее подготовленных запросов для проверки работы API.

## Подготовка Django-проекта к запуску коллекции:
1. Проверьте, что виртуальное окружение развёрнуто и активировано, зависимости проекта установлены.
2. Перейдите в директорию *postman_collection* и командой `bash set_up_data.sh`` запустите bash-скрипт, который создаст в базе данных объекты, необходимые для работы коллекции.  
*Внимание, скрипт предварительно очищает существующую базу данных.*
3. Перейдите в директорию с файлом `manage.py` и запустите сервер разработки.

## Загрузка коллекции в Postman:

1. Запустите Postman;
2. В левом верхнем углу нажмите `File` -> `Import`;
3. Во всплывающем окне будет предложено перетащить в него файл с коллекцией либо выбрать файл через окно файлового менеджера.
Загрузите в Postman файл `Ymdb-collection.postman_collection.json`.

## Запуск коллекции:

**Запускать коллекцию можно только после того, как в коде проекта вы реализуете регистрацию пользователей.** 
К моменту запуска коллекции в проекте должны работать:
- отправка кода подтверждения, 
- повторная отправка кода подтверждения
- получение токена.

В ином случае значительная часть запросов вернётся с ошибкой: коллекция рассчитана на полную готовность функционала проекта.
  
1. После выполнения предыдущих шагов, в левой части окна Postman во вкладке `Collections` появилась импортированная коллекция.
Нажмите на её название, чтобы увидеть содержимое, и найдите директорию *Ymdb-collection/registration // No Auth/get_confirmatior_codes*.
Наведите на нее курсор, нажмите на три точки напротив названия директории и в выпадающем списке выберите `Run folder`. В центре экрана появится список из четырех запросов.
Выполните их, нажав кнопку `Run <название коллекции>`;
2. После выполнения предыдущего шага ваше приложение должно сформировать коды подтверждения для 4-х пользователей. Сохраните полученные коды в переменные коллекции:
- нажмите на название коллекции,
- в появившемся в центре экрана окне перейдите во вкладку `Variables`. 

Заполните колонку `Current_value` для первых четырех переменных.  

| Название переменной | email, использованный при регистрации пользователя |
| ------ | ------ |
| userConfirmationCode | user@no-admin.ru |
| moderatorConfirmationCode | moderator@admin.ru |
| adminConfirmationCode | admin-user@admin.ru |
| superuserConfirmationCode | superuser@admin.ru |

*Не забудьте сохранить изменения.*  
3. Для запуска коллекции наведите на нее курсор, нажмите на три точки напротив названия коллекции и в выпадающем списке выберите `Run collection`.
В появившемся окне отключите первые четыре запроса (они уже были выполнены на первом этапе).  
4. В правом меню включите фунцию `Persist responses for a session` - это даст возможность посмотреть ответы API после запуска коллекции;  
5. Нажмите кнопку `Run <название коллекции>`;  
6. В центре экрана отобразится результат запуска коллекции и тестов. Провалившиеся тесты можно отфильтровать, перейдя во вкладку `Failed`.  
Посмотрите детали выполненного запроса и полученного ответа: для этого нажмите на тест.
  

P.S. После успешного выполнения всех запросов коллекции в базе данных останутся 4 пользователя. Это не помешает повторному запуску коллекции.

Если какие-то запросы завершатся ошибкой, в базе данных могут остаться и иные объекты, способные повлиять на корректность повторного запуска коллекции. В таком случае перед следующим запуском коллекции рекомендуется вновь запустить bash-скрипт и выполнить шаги по настройке коллекции, описанные в начале инструкции.



## Ограничения от разработчиков Postman
В бесплатной версии программы Postman есть техническое ограничение: коллекцию можно беспрепятственно запускать 25 раз в месяц.  
После исчерпания этого лимита Postman не превратится в тыкву: он по-прежнему будет запускать коллекции, но запуск иногда будет блокироваться на 30 секунд (иногда дважды подряд), и в это время в интерфейсе программы будет появляться предложение приобрести платную версию.  
Вы можете купить платную версию, а можете просто продолжить пользоваться бесплатной версией, время от времени прерываясь на просмотр рекламы.

Для отправки отдельных запросов никаких ограничений нет.
